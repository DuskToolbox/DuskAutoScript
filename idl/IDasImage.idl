import "DasBasicTypes.idl";
import "IDasBinaryBuffer.idl";

namespace Das::ExportInterface {

enum DasImageFormat {
    DAS_IMAGE_FORMAT_PNG = 0,
    DAS_IMAGE_FORMAT_RGBA_8888 = 1,
    DAS_IMAGE_FORMAT_RGBX_8888 = 2,
    DAS_IMAGE_FORMAT_RGB_888 = 3,
    DAS_IMAGE_FORMAT_JPG = 4,
    DAS_IMAGE_FORMAT_FORCE_DWORD = 0x7FFFFFFF
};

struct DasSize {
    int32_t width;
    int32_t height;
};

[uuid("6C98E79F-2342-4B98-AC8A-2B29EA53F951")]
interface IDasImage : IDasBase {
    DasResult GetSize([out] DasSize* p_out_size);
    DasResult GetChannelCount([out] int32_t* p_out_channel_count);
    DasResult Clip(const DasRect* p_rect, [out] IDasImage** p_out_image);
    DasResult GetDataSize([out] uint64_t* p_out_size);

    /**
     * @brief 获取图像原始数据缓冲区
     *
     * @note 此方法替代了旧的 GetData 方法。
     *       旧方法：GetData([out] unsigned char**) - 返回裸指针
     *       新方法：GetBinaryBuffer([out, ref] IDasBinaryBuffer*) - 返回包装好的缓冲区对象
     *
     *       优势：
     *       - IDasBinaryBuffer 明确持有数据所有权，避免内存管理歧义
     *       - 跨语言绑定更清晰（Python/C#/Java 均有对应的缓冲区对象）
     *       - 类型安全，减少内存泄漏风险
     *
     * @param p_out_buffer 输出参数，返回 IDasBinaryBuffer 指针
     *
     * @return DasResult 操作结果
     */
    DasResult GetBinaryBuffer([out] IDasBinaryBuffer** pp_out_buffer);
}

}